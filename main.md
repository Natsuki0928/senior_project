\documentclass[11pt,a4paper,fleqn]{jarticle}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{ascmac}
\usepackage{amsmath}
\usepackage[dvipdfmx]{graphicx}
\usepackage{geometry}
\usepackage{fancybox}
\usepackage{siunitx}
\usepackage{url}
\geometry{left=25truemm,right=25truemm,top=25truemm,bottom=25truemm}
\setcounter{tocdepth}{2}
\def \Sum {\displaystyle\sum}
\makeatletter
\def\@year{２０２０　年　度}
\def\@thesis{卒　業　論　文}
\def\id#1{\def\@id{#1}}
\def\department#1{\def\@department{#1}}
\def\teacher#1{\def\@teacher{#1}}

\def\@maketitle{
\begin{center}
\quad \par\quad\par \quad\par
{\huge \@year \par}
\vspace{20mm}
{\Huge \@thesis \par}
\vspace{20mm}
{\huge 題 目 \par} \vspace{0.3zw}
{\Huge\bf \@title \par}% 論文のタイトル部分
\quad\par
\end{center}
%\vspace{10mm}
%{\Large \@date\par}	% 提出年月日部分
\vspace{25mm}
\begin{Huge}
\begin{eqnarray*}
\hspace{1.8zw}学\hspace{0.5zw}科\hspace{0.5zw}名&\quad&\@department\\\\	% 所属部分
学籍番号&\quad&\@id \\	% 学籍番号部分
氏\hspace{2zw}名&\quad&\@author \\\\\\% 氏名
指導教員 &\quad& \@teacher
\end{eqnarray*}
\end{Huge}
}
\makeatother
\title{コロナ禍における死亡率予測と\\避難者割当に寄与した制約最適化を用いた\\災害時避難計画の提案}

\author{鈴\hspace{0.5zw}木\hspace{1zw}夏\hspace{0.5zw}樹}
\id{1723011}
\department{流通情報工学科}
\teacher{久\hspace{0.5zw}保\hspace{1zw}幹\hspace{0.5zw}雄}
\begin{document}
\maketitle
\thispagestyle{empty}
\setcounter{page}{0}

\thispagestyle{empty}
\tableofcontents
\newpage

\section{はじめに}
\subsection{研究の背景と目的}

東北地方に甚大な被害をもたらし, 2万人以上の犠牲者を出した東日本大震災から既に10年が経過しようとしている. 近い将来発生すると言われる南海トラフ巨大地震では, 揺れと津波により最悪の場合, 32万人が犠牲になると推計されている. このことから, 都内でも数多くの公共施設が避難所として確保され, 避難計画 が見直されてきた. 

一方, 今回の新型コロナウイルス感染症（以下, 「新型コロナ感染症」という. ）は現在も沈静化することなく猛威を奮っている状況にある. ワクチンや治療薬が国内に普及するまで少なくとも数年はかかる. このような状況下で地震災害や火災が発生すれば, その場所に居合わせた人々は避難計画に沿った行動を余儀なくされる. しかし新型コロナ感染症の影響下では, 従来の避難計画大人数を従来の避難計画通りに公共の施設に多くの避難者を収容すれば, 3密からクラスターの発生に繋がる. 南海トラフ巨大地震が発生した場合, 避難所避難者数は約240〜500万人となる[2]と予想され, 甚大な被害を起こす可能性が大きい. 

 早急な避難の完了のため, また, 新型コロナ感染症の感染拡大の防止のためにも, なんらかの対策をとった避難計画を早急に作成する必要がある. 
新型コロナ感染症蔓延禍で避難計画を考える上では, ソーシャルディスタンスを意識した多様な避難が求められる. 従来の避難の形態に加え, 在宅避難や, 感染した際の死亡リスクの高い人たちを優先的に個室のある施設へ割り当てるべきである. 
また, 避難者それぞれの危険率の産出から避難所の割り当てまでの一連の流れは, 全てオンライン上で行う必要がある. 
本研究では新型コロナ感染症蔓延禍の災害避難計画を作成するために, 死亡リスクの最小化を目的として, 勾配ブースティング木による予測モデルの作成と制約最適化を用いた避難所割り当てモデルの提案を行う. 


\subsection{様々な予測手法}
対象となる個人に嗅覚や味覚の異常や発熱, 陽性者との接触歴などを回答してもらうだけでも感染率や死亡率をある程度予測できる. 
実際に自治体によってはセルフチェックシート[3]を用意し, 症状一つ一つを点数化して市民の意思決定を手助けしている. 
また, 機械学習モデルの構築がある. 年齢や持病の有無や種類と新型コロナ感染症を発症して死亡したかどうかのデータが一定数あれば, そこから機械学習モデルを構築できる. MITのBertsimas氏が中心となって構築したCOVID analyticsでは, 新型コロナ感染症を発症しているか（感染率）と感染した場合の死亡率を予測するwebアプリを使用できる. 実装されているモデルは曲線下面積（AUC）が0.82と, 高い性能をもっている. 

このように構築したモデルに新たなデータを入力すれば, 新型コロナ感染症を発症した際の死亡率や感染率を推定することが可能となる. 


\newpage
\subsection{論文構成}
\begin{itemize}
\item 2 章では,提案するモデルについて述べる.
\item 3 章では,モデルの定式化について述べる.
\item 4 章では,第 3 章で考案した予測モデルに対するLightGBMの適用と結果, 考察ついて述べる
\item 5 章では,第 3 章で考案したモデルに対する制約最適化ソルバーSCOPの適用と求解した実験結果, 考察を述べる.
\item 6 章では,本論文をまとめ,今後の課題について述べる.
\end{itemize}

\section{モデルの説明}
\begin{figure}[h]
\begin{center}
\includegraphics[width=15cm]{figures/model.png}
\caption{モデル図}
\end{center}
\end{figure}

災害時に,  ウイルスをなるべく拡大させずに避難を完了させるには新型コロナ感染症のウイルスに感染しているか（以下,  「感染率」とする)の高い避難者と新型コロナ感染症を発症した場合の死亡率（以下,  「死亡率」とする）の高い避難者を異なる施設に割り当てる必要がある. 一度に大多数の人々が避難を余儀なくされる状況では正確な検査を受ける余裕もないと考えられる. よって感染率,  死亡率は避難者の年齢や体温などによって推定することによって補う. また,  避難者それぞれの死亡率の産出から避難所の割り当てまでの一連の流れは, 全てオンライン上で高速に行う必要がある.本章では１節で予測モデル,  ２節で割り当てモデルの提案を行う.  
\subsection{予測モデル}
避難者が新型コロナ感染症に感染している確率や発症した場合の死亡率を予測する手法を説明する. 
使用するデータは, 2019年12月から2020年4月までに主に中国で行われた研究データセットである. これを教師データとする. 
使用する手法は勾配ブースティング木である. 勾配ブースティングとはブースティングと呼ばれる手法の一種であり, 複数の予測モデル（今回の場合は決定木）を生成しながら判別に使用するデータの重みを更新していく方法であり, 高い分類精度を実現できる. 決定木モデルは一般に可読性に優れており, 避難者への理解を得やすいという観点から, 実際の避難計画に適用がしやすい.  本研究では新型コロナ感染症を発症した際の死亡率を予測するモデルの提案を行う. 先行研究としてBertsimas氏のCOVID Analitycsを参考とし, 決定木の代表的な手法として, XGBoostやLightGBM, ランダムフォレストを比較した上で, 最も精度のよかったLightGBMを採用した. 


\subsection{割り当てモデル}
死亡率が低くなるように避難者それぞれを適切な避難所に割り当てる. 


\subsubsection{避難施設}
避難施設は訪れた避難者を容量を超えないかぎり, 受け入れる. 避難施設は建物ではなく個室ごとに定義する. 任意の２つの避難施設は施設間での感染危険率を定める. 

\subsubsection{避難者}
避難者は割り当てられた避難施設に避難する. 自宅に留まることも一つの選択肢として考える. 避難者それぞれは感染率と感染した際の死亡率をもっており, 避難者同士で感染危険率を定める. 


\newpage
\section{モデルの定式化}
2. 2で述べた割り当てモデルの定式化である. 

\subsection{記号の定義}

\begin{itemize}
\item{集合}
\begin{enumerate}
\item[$I$ : ]避難者の集合．$I=\{1,2,\dots\,,\mid I \mid\}$とし，添え字は$i,j$とする．
\item[$K$ : ]販売施設の集合．$J=\{1,2,\dots\,,\mid K \mid\}$とし，添え字は$k,l$とする．
\end{enumerate}
\item{パラメータ}
\begin{enumerate}
\item[$IR_{i}$ : ]避難者$i$の感染率(％)
\item[$IM_{i}$ : ]避難者$i$の死亡率（％）
\item[$CA_{i}$ : ]施設$k$の収容人数の集合(人)
\item[$D_{k,l}$ : ]施設$k$と施設$l$の間に定義される感染危険率(％), 同じ建物内では大きくなる.
\item[$W_{i,j}$ : ] 避難者$i$と避難者$j$間での感染危険率(％), 以下、(a)と(b)の二つの重みがつく.
\begin{enumerate}
\item $(IR_{j} - IR_{i})^2$
\item (max$(IR_{j} - IR_{i},0)*IM_{i}$ + max$(IR_{i} - IR_{j},0)*IM_{j})$
\end{enumerate}
\item[$H_{i,k}$ : ]避難者$i$が施設$k$に避難した際の危険度(％), ハザードマップなどから決定する. 
\end{enumerate}
\item{変数}
\begin{enumerate}
\item [$X_{i,j}$ : ] 避難者$i$が避難施設$k$に避難すると$1$, それ以外は$0$となるバイナリー変数.

\end{enumerate}
\end{itemize}
\newpage
\subsection{定式化}

\begin{align}
\text{min.}
&\sum_{ {i,j \in I}{k,l \in K} }^{} W_{ij} D_{kl}  x_{ik}  x_{jl} + \sum_{ik \in I}^{} H_{ik} x_{ik}
\end{align}

\begin{align}
\text{s.t.} \notag \\
&\sum_{k}^{} x_{i,k} = 1
&&\hspace{3zw}\forall i \in I
\\[6pt]
&\sum_{i}^{} x_{i,k}  \leq CA_{k}
&&\hspace{3zw}\forall k \in K
\end{align}
目的関数と各制約式の意味を以下に示す．
\begin{description}
\item[$(1)$]目的関数. 各避難者の死亡率の最小化を目的とする. 
\item[$(2)$]すべての避難者 $i$に対して，$x_{i,k}$の施設$k$に対する合計が$1$になる.
\item[$(3)$]すべての避難施設$k$に対して，$x_{i,k}$の避難者$i$に対する合計が施設$k$の容量以下である.
\end{description}

\newpage
\section{LightGBMの適用}
2章で提案した勾配ブースティング木のフレームワークの一つであるLightGBMを使用して, 避難者が新型コロナ感染症を発症した場合の死亡率を回帰分析する. 
\subsection{LightGBM}
LightGBMとは決定木アルゴリズムに基づいた勾配ブースティングの機械学習フレームワークの一つである. 特徴としては勾配ブースティングの過程において「Leaf-wise」と呼ばれる手法で決定技の葉の部分を優先して作成していくことが挙げられる. これにより, 他の勾配ブースティング手法より短時間で学習できる. また, 訓練データの特徴量をヒストグラムにすることで, 大規模なデータセットに関してもメモリ効率よく学習することが可能となる. 
最近ではkaggleと呼ばれる投稿されたデータから最適モデルを作成して精度を競い合うサイトが存在するが, 上位者たちが最も使用している手法でもある. 

\subsection{実験方法}
死亡率予測モデルの作成実験の手順を説明する. 
\\1. データセットを訓練用データと検証用データに分割する.
\\2.訓練用データから死亡率を予測するモデルを作成する. 
\\3. 検証用データを使って, モデルを評価する. 
\\4. パラメータを調整し, 再度モデルを作成する. 
\\5. 2から4をモデルの性能が上がるまで, 繰り返す. 

\subsection{使用データ}
2019年12月から2020年4月までに主に中国で行われた研究データセットである. 
ただし, このデータセットは主に中国の医療機関で実施された研究から得られたものであるため, 日本の一般的な集団の死亡率予測には使用するべきではない. 多くの場合, 医療機関を受診する人々は何らかの症状を既に発症しているため, この集団は無症状者を十分に含んでいないためである. 

\newpage
\subsection{結果と考察}
LightGBMにより作成されたモデルにテストデータを適用した結果を図2に示す. 赤線に近ければ予測値と実測値が近いことになるが, 概ね赤線に沿って分布している. モデルの当てはまりを示す決定係数（R2）の値は0.78. 平均絶対誤差（MAE）は0.0868となった. 平均して約9％の誤差で死亡率を予測できていることがわかる. 
次に特徴量がモデルの精度にどれだけ影響を与えたかを表す重要度のグラフが図3である. 最も誤差を減らしている特徴量はなんらかの疾患の有無である. その次がMeanAge, つまり年齢であり, その下に発熱しているかやCough(咳)やHypertension(高血圧), Diabetes(糖尿病), COPD(喘息)などの具体的な疾患が寄与していることがわかる. 一般的に言われている, 高齢で基礎疾患（喘息や高血圧など）がある人が重症化しやすいという知見とほぼ一致する. また, 避難者が新型コロナ感染症に感染した際の危険率を評価するためには, 基礎疾患や現在の症状を把握する必要性は高いと考えられる. 
図4からハイパーパラメータの一つである決定木の深さは5が適切な値であった. 
図5は決定木を可視化したものである. 左から条件に合致するか否かで枝が分岐していき, ノード一つ一つが葉っぱ, として最終的な予測結果を導き出す. 



\begin{figure}[htbp]
\centering
\includegraphics[width=12cm]{figures/rmse_r2.png}
\caption{残差関係}
\end{figure}
\newpage
\begin{figure}[htbp]
\includegraphics[width=12cm]{figures/importance.png}
\caption{重要度}
\end{figure}
\newpage
\begin{figure}[htbp]
\centering
\includegraphics[width=15cm]{figures/depth.png}
\caption{決定技の深さ}

\includegraphics[width=15cm]{figures/Tree.gv.png}
\caption{決定技の可視化}
\end{figure}

\section{SCOPの適用}
\subsection{SCOPについて}
3章2節で提案した定式化は通常の最適化ソルバーでは求解が困難である. また災害によっては時間的制約も非常に厳しく, 高速で割り当てを行うことが人命を救うことに繋がる. よって今回は制約最適化ソルバーSCOPを使用する. 『SCOPは，大規模な制約計画問題を高速に解くためのソルバーである．ここで，制約計画（constraint programming）とは，従来の数理計画を補完する最適化理論の体系であり，組合せ最適化問題に特化した求解原理-メタフーリスティック-を用いるため，従来の数理計画ソルバーで解けない大規模な問題に対しても，効率的に良好な解を探索することができる．』[4]
このようにSCOPは, 従来の数理計画ソルバーよりも高速で求解できる. ただし, 短時間で発見した解が大域的目的関数値と乖離する可能性もある. 
実験では避難者の割り当て問題を混合整数計画ソルバーGurobiとメタヒューリスティクスを用いたソルバーSCOPの結果の比較を行う.

\newpage
\subsection{SCOPにおいての定式化}
SCOPにおける変数は, 与えられた集合から１つの要素を選択することによって決定される. また, 変数に与えられる集合は領域と呼ばれる. 
そのため変数は下記のようにになり, これにより変数のサイズを大幅に削減できる. 
\begin{enumerate}
\item [$x_{i}$ : ]避難者$i$が避難する施設を表す変数. 領域を$K$とする. 
\end{enumerate}

\subsection{実験に使用するデータ}
\begin{itemize}
\item 避難者: それぞれが感染率と死亡率をもっている. 感染率の高い集団をA, 死亡率の高い集団をB, どちらも低い集団をCとする. 人数比は1:1:8である. 
\item 避難者間の感染危険率
\item 避難施設： 3種類存在する. 1つ目はホテルのように個室になっており, 容量が1人の施設. 2つ目は体育館などの容量が多数の従来の避難施設. 3つ目は避難者の自宅である. 個室と従来の施設は同数ずつ用意し. 避難者の自宅は避難者の数だけ存在する. 
\item 自宅の危険率：避難者はそれぞれ自宅をもつ. 自宅には在宅避難を行う際の危険率が定められている. 今回は10~20の間の乱数を使用
\item 避難施設間の感染危険率: 同じ今回は同様の施設の感染危険率を１, それ以外を0と定める. 

\end{itemize}

\newpage
\subsection{実験環境}
実験環境は以下の通りである．\\
\\
\ovalbox{
\begin{tabular}{l}
OS 名： macOS Catalina\\
プロセッサ： 2.2GHz クアッドコアintel Core i7\\
実装メモリ： 16GB 1600MHq DDR3 \\
使用ソフト： Gurobi 9.0.3, SCOP\\
\end{tabular}
}
\subsection{実験結果と考察}
表1はscopの求解の一例である. 避難者50人に対して, このような結果が得られた. 感染率の高い集団Aは個別部屋のある施設, もしくは自宅避難に割り当てられていることがわかる. 一方死亡率の高い集団Bは, 集団Aと同じ建物に割り当てられていない.図6は避難施設ごとの避難者分布を示している. h1からh5は個室, s1~s5は従来の容量多数の施設である. 図6から集団Bの割り当てられている避難施設はそれぞれ異なることもわかる. 避難者の数が避難所の容量を超えてしまった場合, 自宅の危険度が比較的小さい避難者から自宅避難に割りふられている. 今回はランダムに設定したが, 実際は自宅の周辺の状況から災害ごとに危険度を定量化し, 家ごとのハザードマップを作成する必要があると考えられる. 

\begin{table}[h]
\begin{center}
\label{heading}
\scalebox{1}[1]{
\begin{tabular}{|c|rrrr|} \hline
集団 & 個室 & 従来 & 自宅& 合計\\\hline
A(感染率が高い)&4 & 0& 1& 5 \\
B(死亡率が高い)&1 & 2 & 2 & 5 \\
C(どちらも低い)&0 &29 &11 &40 \\
 & & & & 50 \\

\hline
\end{tabular}
}
\caption{SCOPによる求解例}
\end{center}
\end{table}


\begin{figure}[htbp]
\centering
\includegraphics[width=15cm]{figures/allocation.png}
\caption{避難者の分布}
\end{figure}

\newpage
表2はSCOPと比較対象としてMIPソルバーであるGurobiを使用した求解時間と目的関数値の値の結果である. データ数が20を超えるまではGurobiの方が高速であるが, 40を超えると大幅に増加する. 一方, SCOPは比較的安定している. データ数が増えてもSCOPはGurobiよりも求解時間の増加はなだらかである.目的関数値は50を超えたあたりからGurobiの方が最適解に近づいているが, 求解時間の増加も激しい. 

\begin{table}[h]
\begin{center}
\scalebox{1}[1]{
\begin{tabular}{|c|rrrr|} \hline
避難者数 & SCOP求解時間（秒） & SCOP目的関数値 & Gurobi求解時間（秒）& Gurobi目的関数値\\\hline
10&2.2904 & 414& 0.034&232 \\
20&5.0887 & 1805 & 0.8598 &1805 \\
30&5.1527&1827&8.9542&1827 \\
40&5.4205&5187&54.6736&5187 \\
50&5.7767&8820&262.1898&8722 \\
70&18.5300&23672&88.2793&17319 \\
90&51.4566&44961&357.5611&35244 \\
100&78.1144&53955&433.5633&41778 \\

\hline
\end{tabular}
}
\caption{GurobiとSCOPによる求解時間と目的関数値の平均値}
\end{center}
\end{table}
このことから大規模な避難施設の割り当てにはscopを用いると, 一定の時間的有用性があると考えられる. 実際の避難計画においては, 地区ごとに考えるとしても数千人規模の問題になる. また, さらなるパラメータの増加も想定されるため, この差は大きくなっていくと考えられる. 従って,SCOPを用いての求解が現実的であるといえる. 

\newpage
\section{まとめと今後の課題について}
\subsection{まとめ}
本研究では新型コロナ感染症蔓延禍の災害避難計画を作成するために, 死亡リスクの最小化を目的として, 予測モデルの作成と避難所割り当てモデルの提案を行ってきた.  
４章から避難者の死亡率は, 年齢や現在の症状と基礎疾患から高い精度で予測できることがわかった. ５章では避難者の割り当てモデルを２種類のソルバーによって求解し比較することでSCOPの有用性を確認した. 
\subsection{今後の課題}
\begin{description}
\item [現実のデータを用いた実験]
本研究で用いたデータはあくまで仮のものであり, 実際の地域の人口や避難所の数を使った実験が求められる. 

\item [予算や距離などより現実的な制約の追加]
実際は避難する際の施設選択には, 今回のモデルにはなかった, 避難者と避難施設の位置関係や予算などのパラメータなども関係する. それらを考慮したモデルを作成しなければならない. 

\item [アプリの作成]
本研究のモデルを実際の災害時に役立てるためには, 避難者ひとりひとりから現状の情報を集め, 演算した結果を避難者ひとりひとりに返す必要がある. それらを素早く, また対面せずに行うにはスマートフォンのアプリケーションが最適だと考える. 
\end{description}

\newpage
\addcontentsline{toc}{section}{参考文献}
\begin{thebibliography}{99}
\bibitem{01}
新型コロナ感染症と災害避難研究会 \\
新型コロナウイルス感染症流行時の 災害と避難環境を考える手引き （地方自治体編）\\
URL:
\url{http://npo-cemi.com/covid-19/livingwithcorona.pdf}
\bibitem{02}
中央防災会議 防災対策推進検討会議 南海トラフ巨大地震対策検討ワーキンググループ \\
南海トラフ巨大地震の被害想定について （第二次報告）\\
URL:
\url{http://210.149.141.46/jishin/nankai/taisaku_wg/pdf/20130318_shiryo2_1.pdf}
\bibitem{03}
新型コロナウイルス 感染症　セルフチェックシート（長野県東御市）\\
URL:
\url{http://hospital.city.tomi.nagano.jp/simin/checksheet01.pdf}
\bibitem{04}
久保幹雄 他「Python言語によるビジネスアナリティクス」(pp.319-342),近代科学社,(2016)
\bibitem{05}
LightGBM公式ドキュメント \\
URL:
\url{https://lightgbm.readthedocs.io/en/latest/Features.html}
\end{thebibliography}

\end{document}